<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­Œæ›²æŸ¥è¯¢ç«™ - Bç«™åˆ†Pç›´è¾¾</title>
    <style>
        /* å…¨å±€æ ·å¼é‡ç½® */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        /* æ ‡é¢˜æ ·å¼ */
        h1 { text-align: center; color: #333; margin-bottom: 10px; }
        /* å¯¼èˆªæŒ‰é’® */
        .nav-btn-container { text-align: center; margin-bottom: 30px; }
        .nav-btn { 
            padding: 8px 16px; 
            background-color: #28a745; 
            color: white; 
            text-decoration: none; 
            border-radius: 4px; 
            font-size: 14px; 
            display: inline-block; 
        }
        .nav-btn:hover { background-color: #218838; }
        /* æœç´¢åŒºåŸŸï¼ˆè¾“å…¥æ¡†+æŒ‰é’®ï¼‰ */
        .search-container { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 20px; 
        }
        #search-input { 
            flex: 1; 
            padding: 15px; 
            font-size: 18px; 
            border: 2px solid #ddd; 
            border-radius: 8px; 
            outline: none; 
        }
        #search-input:focus { border-color: #00a1d6; }
        #search-btn { 
            padding: 0 24px; 
            background-color: #00a1d6; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            font-size: 18px; 
            cursor: pointer; 
        }
        #search-btn:hover { background-color: #008ebf; }
        /* æ­Œæ›²åˆ—è¡¨ */
        .list { list-style: none; padding: 0; }
        .item { 
            padding: 15px; 
            border-bottom: 1px solid #eee; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .item:hover { background-color: #f9f9f9; }
        .info { flex: 1; }
        .title { font-weight: bold; font-size: 16px; color: #222; margin-bottom: 5px; }
        .meta { font-size: 14px; color: #666; }
        .link a { 
            padding: 8px 16px; 
            background-color: #00a1d6; 
            color: white; 
            text-decoration: none; 
            border-radius: 4px; 
            font-size: 14px; 
        }
        .link a:hover { background-color: #008ebf; }
        /* æç¤ºæ–‡æ¡ˆ */
        .status-msg, .empty-msg { 
            text-align: center; 
            color: #999; 
            padding: 40px; 
            font-size: 16px; 
        }
        .empty-msg { display: none; }
    </style>
</head>
<body>
    <h1>ğŸµ æˆ‘çš„å·²åˆ‡æ­Œæ›²æŸ¥è¯¢ç«™</h1>
    <div class="nav-btn-container">
        <a href="converter.html" target="_blank" class="nav-btn">ğŸ”„ æ‰“å¼€æ­Œå•æ•°æ®è½¬æ¢å™¨</a>
    </div>

    <!-- æœç´¢åŒºåŸŸï¼ˆè¾“å…¥æ¡†+æŒ‰é’®ï¼‰ -->
    <div class="search-container">
        <input type="text" id="search-input" placeholder="è¾“å…¥æ­Œåã€æ­Œæ‰‹åã€åˆé›†åæˆ–UPä¸»æœç´¢...">
        <button id="search-btn">ğŸ” æœç´¢</button>
    </div>

    <!-- æ­Œæ›²åˆ—è¡¨å®¹å™¨ -->
    <ul class="list" id="song-list">
        <li class="status-msg" id="loading-msg">â³ æ­£åœ¨åŠ è½½æ­Œåº“...</li>
        <li class="empty-msg" id="empty-msg">âŒ æœªæ‰¾åˆ°åŒ¹é…çš„æ­Œæ›²</li>
    </ul>

    <!-- List.js CDNï¼ˆå›½å†…æºï¼Œé¿å…åŠ è½½å¤±è´¥ï¼‰ -->
    <script src="https://cdn.bootcdn.net/ajax/libs/list.js/2.3.1/list.min.js"></script>

    <script>
        // å…¨å±€æ•°æ®å®¹å™¨
        window.SONG_DATA = [];
        let songListInstance = null;

        // 1. åˆå§‹åŒ–List.jsåˆ—è¡¨æ¸²æŸ“
        function initList() {
            const options = {
                valueNames: ['title', 'artist', 'collection', 'up', { data: ['link'] }],
                item: '<li class="item">' +
                        '<div class="info">' +
                            '<div class="title"></div>' +
                            '<div class="meta"><span class="artist"></span> / <span class="collection"></span> / UP: <span class="up"></span></div>' +
                        '</div>' +
                        '<div class="link"><a class="link-btn" target="_blank">ç›´è¾¾Bç«™</a></div>' +
                      '</li>'
            };
            
            // ç§»é™¤åŠ è½½æç¤º
            document.getElementById('loading-msg')?.remove();

            // åˆ›å»ºList.jså®ä¾‹å¹¶åŠ è½½æ•°æ®
            songListInstance = new List('song-list', options);
            songListInstance.add(window.SONG_DATA);

            // ç»‘å®šBç«™é“¾æ¥ç‚¹å‡»äº‹ä»¶
            document.getElementById('song-list').addEventListener('click', function(e) {
                if (e.target.classList.contains('link-btn')) {
                    const item = e.target.closest('.item');
                    const values = songListInstance.get('item', item)[0].values();
                    window.open(values.link, '_blank');
                }
            });

            // åˆå§‹åŒ–æœç´¢åŠŸèƒ½ï¼ˆæ ¸å¿ƒï¼šç»‘å®šå›è½¦/æŒ‰é’®ï¼‰
            initSearch();
        }

        // 2. åˆå§‹åŒ–æœç´¢åŠŸèƒ½ï¼ˆå›è½¦+æŒ‰é’®ç‚¹å‡»ï¼‰
        function initSearch() {
            const searchInput = document.getElementById('search-input');
            const searchBtn = document.getElementById('search-btn');
            const emptyMsg = document.getElementById('empty-msg');

            // æ ¸å¿ƒæœç´¢è¿‡æ»¤é€»è¾‘
            function handleSearch() {
                if (!songListInstance) return; // é˜²æ­¢å®ä¾‹æœªåˆå§‹åŒ–
                const keyword = searchInput.value.trim().toLowerCase();
                songListInstance.search(keyword); // List.jsåŸç”Ÿæœç´¢ï¼ˆåŒ¹é…title/artist/collection/upï¼‰
                
                // æ˜¾ç¤º/éšè—æ— ç»“æœæç¤º
                emptyMsg.style.display = songListInstance.matchingItems.length === 0 ? 'block' : 'none';
            }

            // ç»‘å®šå›è½¦äº‹ä»¶
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.keyCode === 13) {
                    e.preventDefault(); // é˜»æ­¢é»˜è®¤å›è½¦è¡Œä¸º
                    handleSearch();
                }
            });

            // ç»‘å®šæœç´¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            searchBtn.addEventListener('click', handleSearch);

            // å¯é€‰ï¼šå®æ—¶è¾“å…¥æœç´¢ï¼ˆè¾“å…¥æ—¶è‡ªåŠ¨è¿‡æ»¤ï¼‰
            searchInput.addEventListener('input', handleSearch);
        }

        // 3. åŠ¨æ€åŠ è½½å•ä¸ªJSæ•°æ®æ–‡ä»¶
        function loadScript(url) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = url;
                script.onload = resolve;
                script.onerror = reject;
                document.body.appendChild(script);
            });
        }

        // 4. ä¸»æµç¨‹ï¼šåŠ è½½ç´¢å¼•â†’åŠ è½½æ•°æ®â†’åˆå§‹åŒ–åˆ—è¡¨
        async function bootstrap() {
            try {
                // åŠ è½½index.jsonæ¸…å•
                const response = await fetch('data/index.json');
                if (!response.ok) throw new Error('åŠ è½½ç´¢å¼•å¤±è´¥');
                const config = await response.json();
                const files = config.files || [];

                // æ‰¹é‡åŠ è½½æ‰€æœ‰æ•°æ®JSæ–‡ä»¶
                const loadPromises = files.map(filename => loadScript(`data/${filename}`));
                await Promise.all(loadPromises);

                // åˆå§‹åŒ–åˆ—è¡¨å’Œæœç´¢
                initList();

            } catch (error) {
                console.error('å¯åŠ¨å¤±è´¥', error);
                document.getElementById('loading-msg').innerText = 'âŒ åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥data/index.jsoné…ç½®';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåå¯åŠ¨
        document.addEventListener('DOMContentLoaded', bootstrap);
    </script>
</body>
</html>
