<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­Œæ›²æŸ¥è¯¢ç«™ - Bç«™åˆ†Pç›´è¾¾</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
        h1 { text-align: center; color: #333; margin-bottom: 10px; }
        .nav-btn-container { text-align: center; margin-bottom: 30px; }
        .nav-btn { padding: 8px 16px; background-color: #28a745; color: white; text-decoration: none; border-radius: 4px; font-size: 14px; display: inline-block; }
        .nav-btn:hover { background-color: #218838; }
        #search-input { width: 100%; padding: 15px; font-size: 18px; box-sizing: border-box; border: 2px solid #ddd; border-radius: 8px; margin-bottom: 20px; }
        .list { list-style: none; padding: 0; }
        .item { padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .item:hover { background-color: #f9f9f9; }
        .info { flex: 1; }
        .title { font-weight: bold; font-size: 16px; color: #222; margin-bottom: 5px; }
        .meta { font-size: 14px; color: #666; }
        .link a { padding: 8px 16px; background-color: #00a1d6; color: white; text-decoration: none; border-radius: 4px; font-size: 14px; }
        .link a:hover { background-color: #008ebf; }
        .status-msg { text-align: center; color: #999; padding: 40px; font-size: 16px; }
    </style>
</head>
<body>

    <h1>ğŸµ æˆ‘çš„å·²åˆ‡æ­Œæ›²æŸ¥è¯¢ç«™</h1>
    <div class="nav-btn-container">
        <a href="converter.html" target="_blank" class="nav-btn">ğŸ”„ æ‰“å¼€æ­Œå•æ•°æ®è½¬æ¢å™¨</a>
    </div>

    <input type="text" id="search-input" placeholder="è¾“å…¥æ­Œåã€æ­Œæ‰‹åã€åˆé›†åæˆ–UPä¸»æœç´¢...">
    <ul class="list" id="song-list">
        <li class="status-msg" id="loading-msg">â³ æ­£åœ¨åŠ è½½æ­Œåº“...</li>
    </ul>

    <script src="//cdnjs.cloudflare.com/ajax/libs/list.js/2.3.1/list.min.js"></script>

    <script>
        // å…¨å±€æ•°æ®å®¹å™¨
        window.SONG_DATA = [];
        let songListInstance = null;

        // 1. åˆå§‹åŒ– List.js
        function initList() {
            var options = {
                valueNames: [ 'title', 'artist', 'collection', 'up', { data: ['link'] } ],
                item: '<li class="item">' +
                        '<div class="info">' +
                            '<div class="title"></div>' +
                            '<div class="meta"><span class="artist"></span> / <span class="collection"></span> / UP: <span class="up"></span></div>' +
                        '</div>' +
                        '<div class="link"><a class="link-btn" target="_blank">ç›´è¾¾Bç«™</a></div>' +
                      '</li>'
            };
            
            // ç§»é™¤åŠ è½½æç¤º
            document.getElementById('loading-msg')?.remove();

            songListInstance = new List('song-list', options);
            songListInstance.add(window.SONG_DATA);

            // ç»‘å®šç‚¹å‡»äº‹ä»¶
            document.getElementById('song-list').addEventListener('click', function(e) {
                if (e.target.classList.contains('link-btn')) {
                    var item = e.target.closest('.item');
                    var values = songListInstance.get('item', item)[0].values();
                    window.open(values.link, '_blank');
                }
            });
        }

        // 2. åŠ¨æ€åŠ è½½å•ä¸ª JS æ–‡ä»¶
        function loadScript(url) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = url;
                script.onload = resolve;
                script.onerror = reject;
                document.body.appendChild(script);
            });
        }

        // 3. ä¸»æµç¨‹ï¼šè¯»å–æ¸…å• -> åŠ è½½å…¨éƒ¨æ•°æ® -> æ¸²æŸ“
        async function bootstrap() {
            try {
                // ç¬¬ä¸€æ­¥ï¼šè¯»å– index.json æ¸…å•
                const response = await fetch('data/index.json');
                const config = await response.json();
                const files = config.files || [];

                // ç¬¬äºŒæ­¥ï¼šå¹¶å‘åŠ è½½æ‰€æœ‰æ•°æ®æ–‡ä»¶
                const loadPromises = files.map(filename => loadScript(`data/${filename}`));
                await Promise.all(loadPromises);

                // ç¬¬ä¸‰æ­¥ï¼šåˆå§‹åŒ–æ¸²æŸ“
                initList();

            } catch (error) {
                console.error('å¯åŠ¨å¤±è´¥', error);
                document.getElementById('loading-msg').innerText = 'âŒ åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ data/index.json é…ç½®';
            }
        }

        // å¯åŠ¨
        document.addEventListener('DOMContentLoaded', bootstrap);
    </script>
</body>
</html>
