<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Bç«™æ­Œå•JSON -> songDataè½¬æ¢å™¨</title>
    <style>
        body { font-family: sans-serif; max-width: 1000px; margin: 20px auto; padding: 20px; background: #f4f4f4; }
        h2 { border-bottom: 2px solid #00a1d6; padding-bottom: 10px; color: #333; }
        .container { display: flex; gap: 20px; margin-bottom: 20px; }
        .box { flex: 1; display: flex; flex-direction: column; }
        label { font-weight: bold; margin-bottom: 5px; }
        textarea { width: 100%; height: 300px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-family: monospace; resize: vertical; box-sizing: border-box; }
        button { background-color: #00a1d6; color: white; border: none; padding: 10px 20px; font-size: 16px; border-radius: 4px; cursor: pointer; margin-bottom: 20px; }
        button:hover { background-color: #008ebf; }
        .note { background: #fff3cd; padding: 10px; border-radius: 4px; margin-bottom: 20px; color: #856404; }
    </style>
</head>
<body>

    <h2>ğŸµ æ•°æ®è‡ªåŠ¨è½¬æ¢å™¨</h2>
    
    <div class="note">
        <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
        1. åœ¨Bç«™è§†é¢‘é¡µé¢ï¼ŒæŒ‰ä½ <strong>Shift + ç‚¹å‡»æ²¹çŒ´è„šæœ¬æŒ‰é’®</strong> å¤åˆ¶ JSON æ•°æ®ã€‚<br>
        2. å°†æ•°æ®ç²˜è´´åœ¨å·¦ä¾§è¾“å…¥æ¡†ã€‚<br>
        3. ç‚¹å‡»â€œè½¬æ¢â€æŒ‰é’®ï¼Œå¤åˆ¶å³ä¾§ç»“æœæ›¿æ¢ä½ çš„ HTML ä¸­çš„ <code>songData = [...]</code> éƒ¨åˆ†ã€‚
    </div>

    <div class="container">
        <div class="box">
            <label>ç¬¬ä¸€æ­¥ï¼šç²˜è´´ JSON æ•°æ® (æ¥è‡ªæ²¹çŒ´è„šæœ¬)</label>
            <textarea id="input-json" placeholder='[{"collectionBv": "BV1xx...", "collectionTitle": "...", "up": "...", "parts": ["P1...", "P2..."]}]'></textarea>
        </div>
        <div class="box">
            <label>ç¬¬äºŒæ­¥ï¼šè·å– songData ä»£ç </label>
            <textarea id="output-code" readonly placeholder="ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
        </div>
    </div>

    <button onclick="convertData()">ğŸ”„ å¼€å§‹è½¬æ¢</button>
    <button onclick="copyOutput()" style="background-color: #28a745;">ğŸ“‹ å¤åˆ¶ç»“æœ</button>

    <script>
        // è§£ææ­Œåçš„è¾…åŠ©å‡½æ•°ï¼šå°è¯•åˆ†ç¦» "åºå·. æ­Œå - æ­Œæ‰‹"
        function parseTitle(fullTitle) {
            // ç§»é™¤å¼€å¤´çš„åºå· "01. " æˆ– "P1ï¼š"
            let clean = fullTitle.replace(/^\d+\.\s*/, '').replace(/^P\d+[ï¼š:]\s*/, '');
            
            let artist = "æœªçŸ¥æ­Œæ‰‹";
            let title = clean;

            // å°è¯•åŒ¹é… "æ­Œå - æ­Œæ‰‹" æˆ– "æ­Œæ‰‹ - æ­Œå"
            // è¿™é‡Œç®€å•å¤„ç†ï¼Œä»¥æœ€åä¸€ä¸ª " - " ä¸ºåˆ†éš”ç¬¦
            if (clean.includes(' - ')) {
                const parts = clean.split(' - ');
                // å‡è®¾æ ¼å¼æ˜¯ "Title - Artist"
                // å¦‚æœæ˜¯æ—¥æ–‡ï¼Œé€šå¸¸å‰é¢æ˜¯æ­Œåï¼Œåé¢æ˜¯æ­Œæ‰‹æˆ–åä¹‹ï¼Œè¿™é‡Œç®€å•æŠŠååŠæ®µå½“æ­Œæ‰‹
                title = parts.slice(0, -1).join(' - ');
                artist = parts[parts.length - 1];
            } else if (clean.includes('/')) {
                 // æœ‰äº›æ ¼å¼æ˜¯ æ­Œæ‰‹/æ­Œå
                 const parts = clean.split('/');
                 artist = parts[0].trim();
                 title = parts.slice(1).join('/').trim();
            }

            return { title, artist };
        }

        function convertData() {
            const input = document.getElementById('input-json').value.trim();
            if (!input) {
                alert("è¯·å…ˆåœ¨å·¦ä¾§ç²˜è´´æ•°æ®ï¼");
                return;
            }

            try {
                const data = JSON.parse(input);
                const songs = [];

                data.forEach(collection => {
                    const baseLink = `https://www.bilibili.com/video/${collection.collectionBv}`;
                    // å‡€åŒ–åˆé›†åï¼ˆå»æ‰æ—¥æœŸå’ŒUPä¸»æ ‡ç­¾ï¼Œåªç•™æ ¸å¿ƒæ ‡é¢˜ï¼‰
                    let colName = collection.collectionTitle;
                    // ç®€å•çš„å‡€åŒ–é€»è¾‘ï¼šå»æ‰ [xxxx] æ ‡ç­¾
                    colName = colName.replace(/\[.*?\]/g, '').trim();

                    collection.parts.forEach((partStr, index) => {
                        const parsed = parseTitle(partStr);
                        
                        songs.push({
                            title: parsed.title,
                            artist: parsed.artist,
                            collection: colName,
                            up: collection.up,
                            link: `${baseLink}?p=${index + 1}`
                        });
                    });
                });

                // ç”Ÿæˆ JS ä»£ç å­—ç¬¦ä¸²ï¼ˆä¿®æ”¹ç‰ˆï¼‰
let outputStr = `// æ•°æ®æ–‡ä»¶ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString()}\n`;
outputStr += "window.SONG_DATA = window.SONG_DATA || [];\n\n";
outputStr += "window.SONG_DATA.push(\n";

songs.forEach((song, i) => {
    outputStr += `    ${JSON.stringify(song)}`;
    if (i < songs.length - 1) outputStr += ",";
    outputStr += "\n";
});

outputStr += ");";

document.getElementById('output-code').value = outputStr;

            } catch (e) {
                console.error(e);
                alert("JSON è§£æå¤±è´¥ï¼Œè¯·ç¡®ä¿å¤åˆ¶çš„æ˜¯æ­£ç¡®çš„æ•°æ®ï¼\né”™è¯¯ä¿¡æ¯: " + e.message);
            }
        }

        function copyOutput() {
            const textarea = document.getElementById('output-code');
            if(!textarea.value) return;
            textarea.select();
            document.execCommand('copy');
            alert("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼è¯·å»æ›¿æ¢ HTML æ–‡ä»¶é‡Œçš„ songDataã€‚");
        }
    </script>
</body>
</html>
