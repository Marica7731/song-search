# song-search
专为B站歌切内容打造的**歌曲查询与管理系统**，支持**自动化数据采集**，可快速检索分P视频中的歌曲、智能去重、统计演唱者出场频率，一站式管理你的歌切素材库。

## 🎵 直达站点
- 🔍 [歌曲主查询站](https://marica7731.github.io/song-search/)：核心查询、筛选、去重、稿件编辑跳转
- 📊 [演唱者统计与排行页](https://marica7731.github.io/song-search/stats.html)：歌曲出场频率统计、演唱者排行、场次聚合查看

## ✨ 核心功能
### 🤖 自动化数据采集（核心亮点）
- 无需手动整理歌曲数据，只需在配置文件中填入 BV 号，脚本自动抓取分P标题并生成歌库
- 内置智能标题解析：自动识别 `歌名 - 歌手` 格式，提取对应字段；无标准格式时自动标记，方便后续补全
- 支持 GitHub Actions 定时自动运行，实现歌库无人值守更新
- 内置失败重试机制，网络波动时自动重试，提高采集成功率
- 兼容本地/全局 Puppeteer 环境，本地开发与 CI/CD 无缝切换

### 🔍 精准歌曲检索
- 支持按**歌名、歌手、合集名称**多维度搜索，支持实时模糊匹配
- 可按歌曲来源文件快速筛选，精准定位对应合集的内容
- 搜索结果支持分页展示，适配大容量歌库，支持页码快速跳转
- 可自定义搜索范围，仅勾选需要检索的字段，提升搜索精准度

### 🧠 智能去重与标准化
- 内置**字符串标准化引擎**，自动统一全角/半角符号、中英文标点、空格格式，解决「～」与「~」、「，」与「,」、长破折号与短横杠等导致的查重失败问题
- 优化去重规则：无歌手信息的歌曲，自动与同歌名的所有歌曲判定为重复，大幅提升去重准确率
- 实时统计总歌曲数、去重后数量、筛选/搜索结果的去重数据，歌库情况一目了然

### ⚠️ 缺失歌手信息管理
- 无有效歌手信息的歌曲自动**标红高亮**，视觉上快速识别待补全的稿件
- 新增「缺失歌手」专属筛选按钮，一键过滤出所有需要补全歌手信息的内容
- 配合直达编辑页按钮，可快速跳转B站稿件编辑后台，批量补全信息更高效

### 📊 演唱者统计与出场排行
- 自动统计每位歌手的歌曲演唱次数，生成出场频率排行榜，Top3专属奖牌高亮
- 支持按演唱者筛选，查看指定歌手的所有演唱记录
- 聚合展示同一首歌的所有演唱场次，包含对应分P链接、合集名称，快速溯源
- 支持原唱/翻唱标识（需数据字段支持），清晰区分原唱与翻唱内容

### 🛠️ 便捷操作与B站生态适配
- 每首歌自带「直达B站」按钮，一键跳转到对应分P播放页
- 迷你圆形编辑按钮，直接跳转B站视频编辑后台，无需手动查找稿件
- 一键复制歌名（带歌手）、歌手名、合集名、视频链接，支持批量复制全部搜索结果
- 响应式设计，电脑/平板均可流畅使用
- 复制成功轻量Toast提示，操作反馈更友好

## 📖 使用说明
### 一、快速配置（仅需这一步）
本项目支持**全自动数据采集**，无需手动整理歌曲。只需配置 BV 号：

1. 打开 `scripts/update-songs.js` 文件
2. 找到 `SINGER_CONFIGS` 配置数组（约第 70 行）
3. 按照以下格式填入你的B站合集 BV 号：
```javascript
const SINGER_CONFIGS = [
    // 格式：{ bvid: "BV号", file: "保存文件名", alias: "显示别名" }
    { bvid: "BV1G6fLB7Efr", file: "naraetan", alias: "なれたん Naraetan" },
    { bvid: "BV1HRfuBCEXN", file: "figaro", alias: "Figaro" },
    // ... 继续添加更多
];
```
- `bvid`：B站视频的 BV 号（必填）
- `file`：生成的数据文件名（无需后缀，必填）
- `alias`：该合集在网页筛选栏显示的别名（必填）

### 二、本地运行更新脚本
如果你想在本地生成数据：

1. **环境准备**
   - 安装 Node.js (v16+)
   - 在项目根目录执行：`npm install puppeteer`

2. **执行脚本**
   ```bash
   cd scripts
   node update-songs.js
   ```
3. 脚本会自动打开浏览器（无头模式），抓取配置的 BV 号视频，生成数据文件到 `data/` 目录，并自动更新 `index.json`

### 三、基础使用（网页端）
1. 部署/打开页面后，系统会自动加载 `data/` 目录下的所有歌曲数据
2. 在搜索框输入关键词，勾选搜索范围（歌名/歌手/合集），即可快速检索对应歌曲
3. 点击筛选栏的按钮，可按来源合集快速过滤歌曲
4. 点击「直达B站」跳转到对应分P播放页，点击铅笔图标跳转到稿件编辑页
5. 点击内容旁的 📋 图标，可一键复制对应文本内容

### 四、进阶功能使用
1. **缺失歌手批量管理**：点击筛选栏最右侧的「⚠️ 缺失歌手」按钮，一键过滤出所有无有效歌手信息的歌曲，条目标红高亮显示，配合编辑按钮可快速补全稿件信息
2. **去重统计查看**：页面顶部统计栏会实时显示「总歌曲数/去重后数量」，可快速掌握歌库的重复情况
3. **演唱者排行统计**：点击页面顶部的「查看演唱者统计与排行」，进入统计页，可查看歌曲出场频率排行、按演唱者筛选、查看所有演唱场次
4. **批量复制结果**：搜索完成后，点击「📋 复制全部搜索结果」，可一键复制所有搜索到的歌曲信息（歌名+歌手+链接）

### 五、GitHub Actions 自动更新（推荐）
项目已配置好 GitHub Actions 工作流，可实现**定时自动更新歌库**：

1. 将代码推送到你的 GitHub 仓库
2. 确保仓库的 `Settings` -> `Actions` -> `General` -> `Workflow permissions` 设为 `Read and write permissions`
3. 脚本默认配置为**每小时自动执行一次**，也可以在仓库的 `Actions` -> `Auto Update Song List` -> `Run workflow` 手动触发
4. 自动更新成功后，GitHub Actions 会自动提交更改到仓库，GitHub Pages 会自动部署最新版本

**注意**：GitHub Actions 运行环境中，个别视频可能因网络或反爬机制解析失败，脚本已配置容错机制，个别失败不会影响其他歌手更新，也不会终止流程。

## 📁 项目结构
```
song-search/
├── index.html              # 主页面：歌曲查询、筛选、去重、编辑跳转
├── stats.html              # 统计页：演唱者排行、歌曲出场频率统计
├── README.md               # 项目说明文档
├── data/                   # 歌曲数据目录（自动生成，无需手动维护）
│   ├── index.json          # 数据索引配置文件（自动生成）
│   ├── 合集1.js            # 歌曲数据文件1（自动生成）
│   └── ...                 # 更多歌曲数据文件（自动生成）
├── scripts/
│   └── update-songs.js     # ⭐ 核心：数据采集与更新脚本（在此配置BV号）
└── .github/
    └── workflows/
        └── update.yml       # GitHub Actions 自动更新配置
```

## 🚀 部署说明
### 本地运行
1. 将项目文件克隆/下载到本地
2. （可选）配置 `scripts/update-songs.js` 中的 BV 号并运行脚本生成数据
3. 使用本地HTTP服务启动项目（不可直接双击打开HTML文件，会触发浏览器跨域限制）
   - VSCode：使用「Live Server」插件右键启动
   - Python：在项目目录执行 `python -m http.server 8080`
   - Node.js：使用 `serve` 等工具启动
4. 启动后在浏览器访问对应地址（如 `http://localhost:8080`）即可

### GitHub Pages部署（已实现）
1. Fork 本仓库，或推送到你自己的 GitHub 仓库
2. 配置 `scripts/update-songs.js` 中的 `SINGER_CONFIGS`，填入你自己的 BV 号
3. 进入仓库的「Settings」→「Pages」
4. 「Source」选择「Deploy from a branch」，分支选择 `main`（或master），文件夹选择 `/ (root)`
5. （可选）在仓库的「Settings」→「Actions」→「General」中确认 Workflow 权限已开启
6. 保存后等待部署完成，即可通过GitHub Pages地址访问
7. 你的已部署站点：
   - 主查询站：https://marica7731.github.io/song-search/
   - 统计排行页：https://marica7731.github.io/song-search/stats.html

## 📝 更新日志
### v2.3.0 自动化升级
- ✅ 新增 `scripts/update-songs.js` 自动化采集脚本，支持通过配置 BV 号自动生成歌库
- ✅ 新增 Puppeteer 浏览器自动化，支持解析 B 站分 P 列表，智能提取歌名与歌手
- ✅ 新增 GitHub Actions 配置，支持定时/手动触发自动更新并提交代码
- ✅ 优化标题解析逻辑：仅当标题包含标准 ` - ` 格式时才提取歌手，否则使用兜底文本
- ✅ 新增采集失败重试机制、错误日志输出，提高脚本健壮性
- ✅ 更新 README，重点突出自动化配置与使用流程

### v2.2.0 体验优化
- ✅ 调整「缺失歌手」筛选按钮位置，移至筛选栏最右侧，布局更符合使用习惯
- ✅ 主页面新增指向统计页的导航链接，两个页面可互相跳转
- ✅ 优化无歌手歌曲的去重逻辑：无歌手歌曲自动与同歌名所有歌曲判定为重复
- ✅ 新增无歌手歌曲标红高亮显示，视觉上快速识别待补全内容
- ✅ 优化筛选按钮激活状态同步逻辑，切换筛选时状态更准确

### v2.1.0 功能升级
- ✅ 新增「演唱者统计与排行页」，支持歌曲出场频率统计、演唱者筛选、场次聚合展示
- ✅ 新增字符串标准化引擎，解决全角/半角符号、特殊符号导致的查重失败问题
- ✅ 新增批量复制全部搜索结果功能
- ✅ 优化分页逻辑，支持页码跳转、首尾页快速访问
- ✅ 新增歌曲条目hover动效，视觉体验升级

### v2.0.0 正式版本
- ✅ 全新UI设计，渐变背景、卡片式布局，视觉体验全面升级
- ✅ 新增按来源筛选、搜索范围选择功能
- ✅ 新增单条内容一键复制功能
- ✅ 新增B站稿件编辑页直达按钮
- ✅ 实时去重数量统计功能

## ⚠️ 注意事项
1. **自动化采集**：
   - 脚本使用 Puppeteer 进行浏览器自动化，本地运行需确保 Chrome/Chromium 浏览器已安装
   - GitHub Actions 运行时，个别视频可能因网络或页面结构变化解析失败，属于正常现象
   - 建议不要将更新频率设置得过于频繁，避免对 B 站服务器造成压力
2. **数据格式**：
   - 歌曲数据中的B站链接必须包含完整的BV号和分P参数（`?p=xx`），否则无法正常跳转和提取分P信息
   - 必须通过HTTP/HTTPS服务访问项目，直接本地打开文件会因浏览器跨域策略无法加载数据文件
   - 歌手信息为空、或包含「来源处未提供标准格式歌手」的内容，会被判定为无效歌手信息
3. **使用建议**：
   - 建议歌曲数据按合集/年度拆分配置，通过不同的 BV 号管理，避免单个文件过大
   - 页面加载失败时，请检查 `data/index.json` 格式是否正确，以及歌曲文件路径是否配置无误
   - 如遇 B 站页面结构改版导致解析失败，请及时更新 `scripts/update-songs.js` 中的选择器配置
